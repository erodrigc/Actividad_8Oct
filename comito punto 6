
--- CREAMOS LA VISTA PARA EL DETALLE DE LAS FACTURAS
/*
6. Create a view with the following columns (bill_id, sales_person_id, name_of_salesperson, client_id,
name_of_client,
vehicle_id,
brand_of_vehicle,
manufacturer_of_vehicle,
accesory_id,
name_of_accesory). The idea is you can add outside the view 'where bill_id = xx' and displays the
information​ ​ associated​ ​ to​ ​ a ​ ​ bill​ ​ including​ ​ its​ ​ details​ ​ (accessories).​ ​ (0.5)
*/

CREATE OR REPLACE VIEW Details_Invoice_View AS
SELECT 
A."id" BILL_ID,
A."salesperson_id" SALES_PERSON_ID,
C."name" name_of_salesperson,
A."customer_id",
D."name" name_of_client,
A."vehicle_id",
G."name" brand_of_vehicle,
H."name" manufacturer_of_vehicle,
B."option_id" accesory_id,
I."type" name_of_accesory
FROM
"Invoices" A
LEFT JOIN "Invoice_Details" B ON B."invoice_id" = A."id"
INNER JOIN "Salespersons" C ON A."salesperson_id" = C."id"
INNER JOIN "Customers" D ON A."customer_id" = D."id"
INNER JOIN "Vehicles" E ON A."vehicle_id" = E."id"
INNER JOIN "Models" F ON E."model_id" = F."id"
INNER JOIN "Trademarks" G ON F."trademark_id" = G."id"
INNER JOIN "Manufacturers" H ON E."manufacturer_id" = H."id"
INNER JOIN "Options" I ON B."option_id" = I."id"
;

EXPLAIN PLAN FOR SELECT * FROM Details_Invoice_View;
